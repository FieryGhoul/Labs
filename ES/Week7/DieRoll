#include <lpc17xx.h>
#include <stdlib.h>
#include "lcd.h"

#define SW2_PIN 26

void EINT3_IRQHandler(void);
void initializeInterrupt(void);
int generateRandomNumber(void);

int main(void) {
    SystemInit();
    LCD_Init(2, 16);  // Initialize LCD (2 lines, 16 characters per line)
    LCD_Clear();
    LCD_WriteString("Press SW2 to roll");
    
    initializeInterrupt();
    
    while(1) {
        // Main loop
    }
}

void EINT3_IRQHandler(void) {
    int dieValue = generateRandomNumber();
    
    LCD_Clear();
    LCD_WriteString("Die value: ");
    LCD_WriteInt(dieValue);
    
    // Clear the interrupt flag
    LPC_SC->EXTINT = (1 << 3);
}

void initializeInterrupt(void) {
    // Configure P0.26 as EINT3
    LPC_PINCON->PINSEL1 &= ~(3 << 20);
    LPC_PINCON->PINSEL1 |= (1 << 20);
    
    // Configure EINT3 as falling edge triggered
    LPC_SC->EXTMODE = (1 << 3);
    LPC_SC->EXTPOLAR = 0;
    
    // Enable EINT3 interrupt
    NVIC_EnableIRQ(EINT3_IRQn);
    
    // Clear any pending interrupt
    LPC_SC->EXTINT = (1 << 3);
}

int generateRandomNumber(void) {
    return (rand() % 6) + 1;
}
